<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dino Warp Final</title>
    <style>
        body { margin: 0; background: #f7f7f7; overflow: hidden; font-family: 'Courier New', Courier, monospace; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #container { position: relative; width: 800px; height: 350px; }
        canvas { border-bottom: 2px solid #535353; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 350;

        // Assets Mapping
        const audPath = 'audio/';
        const sounds = {
            m1k: new Audio(audPath + 'aplausos_2.mp3'),
            m10k: new Audio(audPath + '-audiotrimmer_adesehy.mp3'),
            over: new Audio(audPath + 'directed-by-robert-b_voI2Z4T.mp3'),
            whoosh: new Audio(audPath + 'slowmo_whoosh.mp3')
        };

        const imgPath = 'images/';
        const dinoImg = new Image(); dinoImg.src = imgPath + 'Screenshot_2025-12-27-14-38-59-263_com.android.chrome-edit.jpg';
        const cactusImg = new Image(); cactusImg.src = imgPath + 'Screenshot_2025-12-27-14-52-08-378_com.android.chrome-edit.jpg';

        let imagesLoaded = 0;
        [dinoImg, cactusImg].forEach(img => img.onload = () => imagesLoaded++);

        // Game Variables
        let score = 0, gameSpeed = 5, isGameOver = false, gameStarted = false;
        let frameCount = 0, highScore = localStorage.getItem('dinoHS') || 0;
        let canFly = false, isInvincible = false, isSlowMo = false;
        let spaceCount = 0, lastSpaceTime = 0, warpFlash = 0, lightningFlash = 0;

        let dino = { x: 50, y: 220, dy: 0, w: 44, h: 44, ground: 220 };
        let obstacles = [], clouds = [], rain = [], ripples = [];

        // Setup Scene
        for(let i=0; i<6; i++) clouds.push({ x: Math.random()*800, y: 30+Math.random()*80, s: 0.5+Math.random() });
        for(let i=0; i<40; i++) rain.push({ x: Math.random()*800, y: Math.random()*350 });

        function update() {
            if (isGameOver || !gameStarted) return;
            frameCount++;

            let effectiveSpeed = isSlowMo ? gameSpeed * 0.15 : gameSpeed;
            score += (canFly && !isSlowMo) ? 5 : 0.15;

            // Sound Milestones
            if (Math.floor(score) === 1000) sounds.m1k.play();
            if (Math.floor(score) === 10000) sounds.m10k.play();

            // Background Math
            let cycle = (Math.sin((score/2000)*Math.PI - (Math.PI/2)) + 1) / 2;
            let isNight = cycle > 0.6;
            let isStorming = (canFly && isNight && !isSlowMo);

            if (isStorming && Math.random() > 0.98) lightningFlash = 5;
            if (lightningFlash > 0) lightningFlash--;
            if (warpFlash > 0) warpFlash--;

            document.body.style.backgroundColor = lightningFlash > 0 ? '#fff' : (isSlowMo ? '#d0e5ff' : getSkyColor(cycle));

            // Movement
            if (!canFly) {
                dino.dy += 0.6; dino.y += dino.dy;
                if (dino.y > dino.ground) { dino.y = dino.ground; dino.dy = 0; }
            }

            if (!isSlowMo) gameSpeed += canFly ? 0.2 : 0.0015;

            // Obstacles logic
            if (frameCount % Math.floor(700/gameSpeed) === 0) {
                obstacles.push({ x: 800, y: Math.random() > 0.3 ? 220 : 120, w: 30, h: 45 });
            }

            obstacles.forEach((obs, i) => {
                obs.x -= effectiveSpeed;
                if (!isInvincible && dino.x < obs.x+obs.w && dino.x+dino.w > obs.x && dino.y < obs.y+obs.h && dino.y+dino.h > obs.y) {
                    isGameOver = true; sounds.over.play();
                }
                if (obs.x < -50) obstacles.splice(i, 1);
            });

            draw(cycle, isNight, isStorming);
            requestAnimationFrame(update);
        }

        function getSkyColor(c) {
            let r = 247 - (c*220), g = 247 - (c*220), b = 247 - (c*180);
            return `rgb(${r},${g},${b})`;
        }

        function draw(cycle, isNight, isStorming) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Celestial Body
            const angle = (cycle * Math.PI) + Math.PI;
            ctx.fillStyle = isNight ? "#eee" : "#FFD700";
            ctx.beginPath();
            ctx.arc(400 + Math.cos(angle)*300, 150 + Math.sin(angle)*100, canFly?40:25, 0, Math.PI*2);
            ctx.fill();

            // Clouds
            ctx.fillStyle = isNight ? "#666" : "#ddd";
            clouds.forEach(c => {
                c.x -= c.s * (canFly?10:1);
                if (c.x < -100) c.x = 850;
                ctx.beginPath(); ctx.arc(c.x, c.y, 20, 0, Math.PI*2); ctx.fill();
            });

            // Storm
            if (isStorming) {
                ctx.strokeStyle = "rgba(180, 200, 255, 0.5)";
                rain.forEach(r => {
                    r.y += 20; r.x -= 10;
                    if (r.y > 350) { r.y = -20; r.x = Math.random()*800; }
                    ctx.beginPath(); ctx.moveTo(r.x, r.y); ctx.lineTo(r.x-5, r.y+10); ctx.stroke();
                });
            }

            // Dino
            if (isNight && lightningFlash <= 0) ctx.filter = 'invert(1)';
            ctx.drawImage(dinoImg, dino.x, dino.y, dino.w, dino.h);
            
            // Obstacles
            obstacles.forEach(obs => ctx.drawImage(cactusImg, obs.x, obs.y, obs.w, obs.h));
            ctx.filter = 'none';

            // UI
            ctx.fillStyle = isNight ? "#eee" : "#535353";
            ctx.font = "20px Courier New";
            ctx.fillText(`HI ${Math.max(highScore, Math.floor(score)).toString().padStart(5, '0')} ${Math.floor(score).toString().padStart(5, '0')}`, 550, 40);

            if (warpFlash > 0) { ctx.fillStyle = `rgba(255,255,255,${warpFlash/10})`; ctx.fillRect(0,0,800,350); }
            if (isGameOver) ctx.fillText("GAME OVER - PRESS R", 300, 180);
        }

        window.addEventListener('keydown', e => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                if (!gameStarted && imagesLoaded >= 2) { gameStarted = true; update(); }
                if (dino.y >= dino.ground && !canFly) dino.dy = -12;

                let now = Date.now();
                if (now - lastSpaceTime < 300) spaceCount++; else spaceCount = 1;
                lastSpaceTime = now;
                if (spaceCount >= 3 && !canFly) {
                    canFly = true; isInvincible = true; gameSpeed = 50; warpFlash = 10;
                }
            }
            if (e.code === 'KeyR') {
                if (isGameOver) location.reload();
                else if (canFly) {
                    sounds.whoosh.play();
                    canFly = false; isInvincible = false; isSlowMo = true;
                    setTimeout(() => isSlowMo = false, 2000);
                }
            }
            if (canFly) {
                if (e.code === 'ArrowUp') dino.y -= 40;
                if (e.code === 'ArrowDown') dino.y += 40;
            }
        });

        // Start Text
        ctx.fillStyle = "#535353"; ctx.font = "20px Courier New";
        ctx.fillText("WAITING FOR IMAGES...", 280, 180);
        const checkLoad = setInterval(() => {
            if (imagesLoaded >= 2) {
                ctx.clearRect(0,0,800,350);
                ctx.fillText("READY! PRESS SPACE", 300, 180);
                clearInterval(checkLoad);
            }
        }, 100);
    </script>
</body>
</html>
