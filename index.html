<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dino Biome Runner</title>
<style>
body{
    margin:0;
    background:#0b1020;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:Courier, monospace;
}
canvas{
    box-shadow:0 0 25px #000;
}
</style>
</head>
<body>

<canvas id="game" width="800" height="220"></canvas>

<script>
const c = document.getElementById("game");
const ctx = c.getContext("2d");

const GROUND = 150;
let speed = 6;
let score = 0;
let hi = localStorage.getItem("hi")||0;
let started=false, gameOver=false, frame=0;
let obstacles=[], clouds=[];
let canFly=false, lastTap=0, tapCount=0;
let keys={up:false,down:false};

// ---------- AUDIO ----------
const applause = new Audio("aplausos_2.mp3");
const big = new Audio("audiotrimmer_adesehy.mp3");
const death = new Audio("directed-by-robert-b_voI2Z4T.mp3");

const ac = new (window.AudioContext||window.webkitAudioContext)();
function ding(f=1000){
    const o=ac.createOscillator(), g=ac.createGain();
    o.frequency.value=f; g.gain.value=0.1;
    o.connect(g); g.connect(ac.destination);
    o.start(); o.stop(ac.currentTime+0.15);
}

// ---------- BIOMES ----------
const BIOMES=["forest","desert","mountain","snow"];
let biomeIndex=0, biomeTimer=0;

function biome(){
    return BIOMES[biomeIndex];
}

// ---------- DINO ----------
const dino={
x:50,y:GROUND,w:30,h:34,dy:0,jump:false,targetY:GROUND,
update(){
    if(canFly){
        if(keys.up) this.targetY-=10;
        if(keys.down) this.targetY+=10;
        this.targetY=Math.max(30,Math.min(GROUND,this.targetY));
        this.y+=(this.targetY-this.y)*0.3;
        this.dy=0;
    }else{
        this.dy+=0.6;
        this.y+=this.dy;
        if(this.y>=GROUND){
            this.y=GROUND; this.dy=0; this.jump=false;
        }
    }
},
draw(){
    ctx.fillStyle="#2ecc71";
    ctx.fillRect(this.x,this.y,this.w,this.h);
    ctx.fillRect(this.x+18,this.y-6,14,14);
    ctx.fillStyle="#fff";
    ctx.fillRect(this.x+26,this.y-2,3,3);
    ctx.fillStyle="#145a32";
    ctx.fillRect(this.x+5,this.y+this.h,6,8);
    ctx.fillRect(this.x+18,this.y+this.h,6,8);
    if(canFly){
        ctx.fillStyle="#ff9800";
        ctx.fillText("FLIGHT",this.x-4,this.y-10);
    }
},
jumpUp(){
    if(!canFly && !this.jump){
        this.dy=-11; this.jump=true; ding(600);
    }
}
};

// ---------- OBSTACLES ----------
class Cactus{
constructor(){
    this.x=c.width;
    this.h=40+Math.random()*15;
    this.w=20;
    this.y=GROUND+34-this.h;
}
update(){ this.x-=speed; }
draw(){
    ctx.fillStyle="#27ae60";
    ctx.fillRect(this.x,this.y,8,this.h);
    ctx.fillRect(this.x-6,this.y+12,6,16);
    ctx.fillRect(this.x+8,this.y+18,6,14);
}
hit(d){
    return d.x<this.x+this.w && d.x+d.w>this.x &&
           d.y<this.y+this.h && d.y+d.h>this.y;
}}
class Ptero{
constructor(){
    this.x=c.width;
    this.y=50+Math.random()*50;
    this.w=38; this.h=20;
}
update(){ this.x-=speed+1; }
draw(){
    ctx.fillStyle="#c0392b";
    ctx.fillRect(this.x,this.y,14,6);
    ctx.fillRect(this.x+18,this.y,14,6);
    ctx.fillStyle="#8e2c23";
    ctx.fillRect(this.x+12,this.y+8,14,6);
}
hit(d){
    return d.x<this.x+this.w && d.x+d.w>this.x &&
           d.y<this.y+this.h && d.y+d.h>this.y;
}}

// ---------- CLOUD ----------
class Cloud{
constructor(){
    this.x=c.width;
    this.y=20+Math.random()*40;
}
update(){ this.x-=1; }
draw(){
    ctx.fillStyle="rgba(255,255,255,0.7)";
    ctx.beginPath();
    ctx.arc(this.x,this.y,18,0,Math.PI*2);
    ctx.arc(this.x+25,this.y-4,22,0,Math.PI*2);
    ctx.arc(this.x+55,this.y,18,0,Math.PI*2);
    ctx.fill();
}}

// ---------- BACKGROUND ----------
function drawBackground(){
    if(biome()==="forest") ctx.fillStyle="#87ceeb";
    if(biome()==="desert") ctx.fillStyle="#f4d03f";
    if(biome()==="mountain") ctx.fillStyle="#aab7b8";
    if(biome()==="snow") ctx.fillStyle="#eaf2f8";
    ctx.fillRect(0,0,c.width,c.height);

    if(biome()==="mountain"){
        ctx.fillStyle="#5d6d7e";
        for(let i=0;i<5;i++){
            ctx.beginPath();
            ctx.moveTo(i*200,GROUND+40);
            ctx.lineTo(i*200+100,60);
            ctx.lineTo(i*200+200,GROUND+40);
            ctx.fill();
        }
    }
}

// ---------- LOOP ----------
function loop(){
    ctx.clearRect(0,0,c.width,c.height);
    drawBackground();

    clouds.forEach(cl=>{cl.update(); cl.draw();});
    clouds=clouds.filter(cl=>cl.x>-80);

    ctx.strokeStyle="#333";
    ctx.beginPath();
    ctx.moveTo(0,GROUND+34);
    ctx.lineTo(c.width,GROUND+34);
    ctx.stroke();

    if(!started){
        dino.draw();
        ctx.fillStyle="#000";
        ctx.fillText("SPACE / CLICK TO START",280,110);
        requestAnimationFrame(loop); return;
    }
    if(gameOver){
        ctx.fillText("GAME OVER",350,100);
        ctx.fillText("R to restart",350,120);
        return;
    }

    biomeTimer++;
    if(biomeTimer>1200){
        biomeIndex=(biomeIndex+1)%BIOMES.length;
        biomeTimer=0;
    }

    const prev=Math.floor(score);
    score+=canFly?250/60:100/240;
    const s=Math.floor(score);

    if(s!==prev && s>0){
        if(s%10000===0){ big.currentTime=0; big.play(); }
        else if(s%1000===0){ applause.currentTime=0; applause.play(); }
        else if(s%100===0){ ding(); }
    }

    dino.update(); dino.draw();

    if(Math.random()>0.985) obstacles.push(Math.random()>0.5?new Cactus():new Ptero());
    if(Math.random()>0.99) clouds.push(new Cloud());

    obstacles.forEach(o=>{
        o.update(); o.draw();
        if(o.hit(dino)){
            gameOver=true; death.play();
            if(score>hi){ hi=score; localStorage.setItem("hi",Math.floor(hi)); }
        }
    });
    obstacles=obstacles.filter(o=>o.x>-50);

    ctx.fillStyle="#000";
    ctx.fillText("HI "+Math.floor(hi),700,20);
    ctx.fillText(Math.floor(score),700,40);

    frame++; requestAnimationFrame(loop);
}

// ---------- INPUT ----------
document.addEventListener("keydown",e=>{
    ac.resume();
    if(e.code==="Space"){
        if(!started){ started=true; return; }
        const now=Date.now();
        tapCount = now-lastTap<400 ? tapCount+1 : 1;
        lastTap=now;
        if(tapCount>=2 && !canFly){ canFly=true; tapCount=0; }
        else dino.jumpUp();
    }
    if(e.code==="ArrowUp") keys.up=true;
    if(e.code==="ArrowDown") keys.down=true;
    if(e.code==="KeyR" && gameOver) location.reload();
});
document.addEventListener("keyup",e=>{
    if(e.code==="ArrowUp") keys.up=false;
    if(e.code==="ArrowDown") keys.down=false;
});
c.addEventListener("click",()=>{
    ac.resume();
    if(!started){ started=true; return; }
    dino.jumpUp();
});

loop();
</script>
</body>
</html>
