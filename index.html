<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dino Warp: Night Flight Edition</title>
    <style>
        body { margin: 0; background: #222; overflow: hidden; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #container { position: relative; width: 800px; height: 350px; background: #f7f7f7; border-bottom: 4px solid #535353; overflow: hidden; transition: background 1s; }
        canvas { display: block; width: 100%; height: 100%; image-rendering: pixelated; }
        #audio-hint { position: absolute; top: 10px; left: 10px; font-size: 10px; color: #999; pointer-events: none; z-index: 10; }
    </style>
</head>
<body>
    <div id="container" onclick="unlockAudio()">
        <div id="audio-hint">CLICK TO SYNC AUDIO</div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 350;

        const GROUND_Y = 310;
        const GITHUB_BASE = "https://raw.githubusercontent.com/yyy293/dino-game/main/";
        
        const snd = {
            m1k: new Audio(GITHUB_BASE + "aplausos_2.mp3"),
            m10k: new Audio(GITHUB_BASE + "-audiotrimmer_adesehy.mp3"),
            lose: new Audio(GITHUB_BASE + "directed-by-robert-b_voI2Z4T.mp3")
        };

        let state = {
            started: false, over: false, score: 0, speed: 6,
            highScore: localStorage.getItem('dinoHS') || 0,
            frame: 0, m1kPlayed: false, m10kPlayed: false,
            isDucking: false, audioUnlocked: false, isNight: false
        };

        const dino = { x: 50, y: GROUND_Y - 44, dy: 0, w: 40, h: 44 };
        let obstacles = [], stars = [], clouds = [], particles = [];

        for(let i=0; i<30; i++) stars.push({x: Math.random()*800, y: Math.random()*200, r: Math.random()*1.5});
        for(let i=0; i<5; i++) clouds.push({x: Math.random()*800, y: 30 + Math.random()*70, s: 0.5, w: 40});

        function unlockAudio() {
            if (state.audioUnlocked) return;
            for (let s in snd) { snd[s].play().then(() => { snd[s].pause(); snd[s].currentTime = 0; }).catch(() => {}); }
            state.audioUnlocked = true;
            document.getElementById('audio-hint').style.display = 'none';
        }

        // --- PIXEL DRAWING ---
        function drawDino(x, y, isDucking, color) {
            ctx.fillStyle = color;
            if (isDucking) {
                ctx.fillRect(x, y + 20, 55, 20); // Body
                ctx.fillRect(x + 45, y + 10, 15, 12); // Head
            } else {
                ctx.fillRect(x + 20, y, 20, 15);     // Head
                ctx.fillRect(x + 10, y + 12, 25, 22); // Body
                ctx.fillRect(x, y + 15, 10, 15);     // Tail
                let leg = Math.floor(state.frame / 8) % 2 === 0 ? 0 : 5;
                ctx.fillRect(x + 12, y + 34, 6, 10); 
                ctx.fillRect(x + 25, y + 34, 6, 10);
            }
        }

        function drawPtero(x, y, frame, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x + 10, y, 20, 10); // Body
            ctx.fillRect(x + 30, y - 5, 10, 8); // Head
            let flap = Math.floor(frame / 10) % 2 === 0 ? -15 : 15;
            ctx.fillRect(x, y + (flap < 0 ? flap : 0), 12, Math.abs(flap)); // Left Wing
            ctx.fillRect(x + 28, y + (flap < 0 ? flap : 0), 12, Math.abs(flap)); // Right Wing
        }

        function update() {
            state.frame++;
            state.score += 0.15;
            state.isNight = Math.floor(state.score / 500) % 2 === 1;

            if (state.score >= 1000 && !state.m1kPlayed) { snd.m1k.play(); state.m1kPlayed = true; }
            
            dino.dy += 0.8;
            dino.y += dino.dy;
            let curH = state.isDucking ? 25 : 44;
            if (dino.y > GROUND_Y - curH) { dino.y = GROUND_Y - curH; dino.dy = 0; }
            
            state.speed += 0.001;

            // Spawn Obstacles (Cactus or Ptero)
            if (state.frame % Math.max(45, Math.floor(700/state.speed)) === 0) {
                let type = (state.score > 500 && Math.random() > 0.6) ? 'ptero' : 'cactus';
                if (type === 'ptero') {
                    // Pteros can be high (jump) or low (duck)
                    let pteroY = Math.random() > 0.5 ? GROUND_Y - 80 : GROUND_Y - 35;
                    obstacles.push({x: 850, y: pteroY, w: 40, h: 20, type: 'ptero'});
                } else {
                    obstacles.push({x: 850, y: GROUND_Y - 40, w: 25, h: 40, type: 'cactus'});
                }
            }

            obstacles.forEach((o, i) => {
                o.x -= state.speed;
                // Collision
                let dW = state.isDucking ? 55 : 35;
                let dH = state.isDucking ? 25 : 44;
                if (dino.x < o.x + o.w && dino.x + dW > o.x && dino.y < o.y + o.h && dino.y + dH > o.y) endGame();
            });
            obstacles = obstacles.filter(o => o.x > -100);
        }

        function endGame() {
            state.over = true;
            snd.lose.play();
            if (state.score > state.highScore) {
                state.highScore = Math.floor(state.score);
                localStorage.setItem('dinoHS', state.highScore);
            }
        }

        function draw() {
            ctx.fillStyle = state.isNight ? "#202124" : "#f7f7f7";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            let mainColor = state.isNight ? "#ddd" : "#535353";

            if (state.isNight) {
                ctx.fillStyle = "#555";
                stars.forEach(s => ctx.fillRect(s.x, s.y, s.r, s.r));
            }

            ctx.strokeStyle = mainColor;
            ctx.beginPath(); ctx.moveTo(0, GROUND_Y); ctx.lineTo(800, GROUND_Y); ctx.stroke();

            drawDino(dino.x, dino.y, state.isDucking, mainColor);

            obstacles.forEach(o => {
                if (o.type === 'ptero') drawPtero(o.x, o.y, state.frame, mainColor);
                else {
                    ctx.fillStyle = mainColor;
                    ctx.fillRect(o.x, o.y, o.w, o.h); // Cactus
                }
            });

            ctx.fillStyle = mainColor;
            ctx.font = "18px Courier New";
            ctx.textAlign = "right";
            ctx.fillText(`${Math.floor(state.score).toString().padStart(5, '0')}`, 780, 40);

            if (state.over) {
                ctx.fillStyle = "rgba(0,0,0,0.8)";
                ctx.fillRect(0,0,800,350);
                ctx.fillStyle = "#fff"; ctx.textAlign = "center";
                ctx.fillText("GAME OVER - PRESS R", 400, 175);
            }
        }

        function gameLoop() {
            if (!state.over) {
                if (state.started) update();
                draw();
            }
            requestAnimationFrame(gameLoop);
        }

        window.addEventListener('keydown', e => {
            unlockAudio();
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                if (!state.started) state.started = true;
                if (dino.y >= GROUND_Y - 45) dino.dy = -13;
            }
            if (e.code === 'ArrowDown') state.isDucking = true;
            if (e.code === 'KeyR' && state.over) location.reload();
        });

        window.addEventListener('keyup', e => {
            if (e.code === 'ArrowDown') state.isDucking = false;
        });

        gameLoop();
    </script>
</body>
</html>
