<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dino Game</title>
    <style>
        * { margin: 0; padding: 0; }
        body { 
            display: flex;
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            background: #222;
        }
        canvas { 
            border: 2px solid #fff;
        }
    </style>
</head>
<body>
    <!-- Main Canvas -->
    <canvas id="game" width="800" height="200"></canvas>
    <!-- Backup Canvas (Invisible for redundancy) -->
    <canvas id="backupCanvas" width="800" height="200" style="display:none;"></canvas>

    <script>
        const c = document.getElementById('game');
        const ctx = c.getContext('2d');

        // Backup Canvas and Context
        const backupCanvas = document.getElementById('backupCanvas');
        const backupCtx = backupCanvas.getContext('2d');
        
        let speed = 6, score = 0, high = 0, over = false, start = false;
        let obs = [], frame = 0, next = 100, space = 0, last = 0, fly = false;
        let god = false, keys = {u:false, d:false};
        let audioEnabled = false;

        // Audio files
        const audioDing = new Audio('https://www.soundjay.com/button/beep-07.wav');
        const applause = new Audio('https://www.soundjay.com/button/beep-04.wav');
        const celebration = new Audio('https://www.soundjay.com/button/beep-08.wav');
        const gameOverAudio = new Audio('https://www.soundjay.com/button/beep-09.wav');

        function promptAudio() {
            ctx.fillStyle = '#fff';
            ctx.font = '20px Courier';
            ctx.textAlign = 'center';
            ctx.fillText('Click to enable audio, or press Enter to disable it.', 400, 100);
        }

        // Enable audio when clicking or pressing Enter
        c.addEventListener('click', () => {
            audioEnabled = true;
            ctx.clearRect(0, 0, 800, 200);
            backupCtx.clearRect(0, 0, 800, 200); // Clear backup canvas as well
            startGame();
        });

        document.addEventListener('keydown', e => {
            if (e.code === 'Enter') {
                audioEnabled = false;
                ctx.clearRect(0, 0, 800, 200);
                backupCtx.clearRect(0, 0, 800, 200); // Clear backup canvas as well
                startGame();
            }
        });

        // Start the game
        function startGame() {
            const dino = {
                x: 50, y: 150, w: 44, h: 47, dy: 0, jump: false, leg: 0, ty: 150,

                // Dino jump logic
                update() {
                    if (fly) {
                        if (keys.u) this.ty = Math.max(20, this.ty - 12);
                        if (keys.d) this.ty = Math.min(150, this.ty + 12);
                        this.y += (this.ty - this.y) * 0.4;
                    } else {
                        this.dy += 0.6;
                        this.y += this.dy;
                        if (this.y >= 150) {
                            this.y = 150;
                            this.dy = 0;
                            this.jump = false;
                        }
                    }
                    if (this.y >= 150 && frame % 5 === 0) this.leg = 1 - this.leg;
                },

                // Drawing the dino
                draw() {
                    ctx.fillStyle = fly ? '#0BF' : '#535';
                    ctx.fillRect(this.x + 20, this.y, 22, 22);
                    ctx.fillRect(this.x + 35, this.y + 10, 7, 12);
                    ctx.fillRect(this.x + 35, this.y + 2, 15, 10);
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(this.x + 45, this.y + 4, 3, 3);
                    ctx.fillStyle = fly ? '#0BF' : '#535';
                    ctx.fillRect(this.x + 10, this.y + 18, 12, 4);
                    ctx.fillRect(this.x, this.y + 16, 12, 4);
                    if (this.leg === 0) {
                        ctx.fillRect(this.x + 20, this.y + 22, 6, 10);
                        ctx.fillRect(this.x + 30, this.y + 22, 6, 10);
                    } else {
                        ctx.fillRect(this.x + 22, this.y + 22, 6, 10);
                        ctx.fillRect(this.x + 28, this.y + 22, 6, 10);
                    }

                    if (fly) {
                        ctx.fillStyle = '#F80';
                        ctx.font = '16px Courier';
                        ctx.fillText('FLIGHT!', this.x - 10, this.y - 10);
                    }
                }
            };

            const clouds = [];
            for (let i = 0; i < 5; i++) {
                clouds.push({x: Math.random() * 800, y: Math.random() * 100, size: Math.random() * 40 + 20});
            }

            const shootingStars = [];
            function createShootingStar() {
                const x = Math.random() * 800;
                const y = Math.random() * 200;
                const length = Math.random() * 40 + 20;
                const speed = Math.random() * 2 + 2;
                shootingStars.push({ x, y, length, speed });
            }

            function drawClouds() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)'; // Lighter, transparent color for clouds
                clouds.forEach(cloud => {
                    ctx.beginPath();
                    // Creating a more realistic cloud by drawing multiple smaller circles
                    for (let i = 0; i < 5; i++) {
                        const xOffset = Math.random() * 40 - 20; // Random horizontal offset
                        const yOffset = Math.random() * 20 - 10; // Random vertical offset
                        const size = Math.random() * 20 + 20; // Random cloud size between 20 and 40
                        ctx.arc(cloud.x + xOffset, cloud.y + yOffset, size, 0, Math.PI * 2);
                    }
                    ctx.fill();
                    cloud.x -= (cloud.size / 40); // Bigger clouds move faster
                    if (cloud.x < -cloud.size) {
                        cloud.x = 800 + cloud.size;
                        cloud.y = Math.random() * 100; // Reset cloud position
                        cloud.size = Math.random() * 40 + 20; // Randomize cloud size again
                    }
                });
            }

            let isNight = false;
            let currentBiome = "desert";
            function setBiomeAndBackground() {
                if (frame % 200 === 0) {
                    isNight = !isNight;
                    if (frame % 500 === 0) {
                        const biomes = ["desert", "snow", "forest", "tundra"];
                        currentBiome = biomes[Math.floor(Math.random() * biomes.length)];
                    }
                }

                // Day/Night cycle and background color
                if (isNight) {
                    ctx.fillStyle = '#001d2d';
                    ctx.fillRect(0, 0, 800, 200);
                    for (let i = 0; i < 50; i++) {
                        const starX = Math.random() * 800;
                        const starY = Math.random() * 200;
                        ctx.fillStyle = '#fff';
                        ctx.beginPath();
                        ctx.arc(starX, starY, 1, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    if (Math.random() < 0.02) createShootingStar();
                    drawShootingStars();
                } else {
                    ctx.fillStyle = '#87CEEB';
                    ctx.fillRect(0, 0, 800, 200);
                }

                // Draw Biomes
                if (currentBiome === "desert") {
                    ctx.fillStyle = '#F4A300';
                    ctx.fillRect(0, 140, 800, 60);
                } else if (currentBiome === "snow") {
                    ctx.fillStyle = '#ADD8E6';
                    ctx.fillRect(0, 140, 800, 60);
                } else if (currentBiome === "forest") {
                    ctx.fillStyle = '#228B22';
                    ctx.fillRect(0, 140, 800, 60);
                } else if (currentBiome === "tundra") {
                    ctx.fillStyle = '#A9A9A9';
                    ctx.fillRect(0, 140, 800, 60);
                }

                // Draw clouds after biome and background
                drawClouds();
            }

            class Cactus {
                constructor() {
                    this.x = 800;
                    this.y = 152;
                    this.w = 30;
                    this.h = 45;
                }
                draw() {
                    ctx.fillStyle = '#2a6';
                    ctx.fillRect(this.x + 12, this.y, 10, this.h);
                    ctx.fillRect(this.x + 4, this.y + 10, 8, 20);
                    ctx.fillRect(this.x + 22, this.y + 15, 8, 18);
                }
                hits(d) {
                    return d.x < this.x + this.w - 5 && d.x + d.w - 5 > this.x &&
                           d.y < this.y + this.h - 5 && d.y + d.h - 5 > this.y;
                }
            }

            function drawShootingStars() {
                shootingStars.forEach(star => {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.beginPath();
                    ctx.moveTo(star.x, star.y);
                    ctx.lineTo(star.x + star.length, star.y - star.length); // Diagonal shooting star
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.lineWidth = 1;
                    star.x -= star.speed;
                    star.y -= star.speed;
                    if (star.x < 0 || star.y < 0) {
                        shootingStars.splice(shootingStars.indexOf(star), 1);
                    }
                });
            }

            function loop() {
                setBiomeAndBackground();

                // Backup canvas to prevent glitches
                backupCtx.clearRect(0, 0, 800, 200);
                backupCtx.drawImage(c, 0, 0);

                if (!start) {
                    dino.draw();
                    promptAudio();
                    requestAnimationFrame(loop);
                    return;
                }

                if (over) {
                    dino.draw();
                    obs.forEach(o => o.draw());
                    ctx.fillStyle = '#000';
                    ctx.font = 'bold 28px Courier';
                    ctx.textAlign = 'center';
                    ctx.fillText('GAME OVER', 400, 80);
                    ctx.font = '18px Courier';
                    ctx.fillText('Press R to restart', 400, 110);
                    ctx.textAlign = 'right';
                    ctx.fillText('Score: ' + Math.floor(score), 790, 30);
                    ctx.fillText('High: ' + Math.floor(high), 790, 55);
                    return;
                }

                speed = Math.min(14, speed + 0.002);
                score += fly ? 250 / 60 : 100 / 120;

                dino.update();
                dino.draw();

                next--;
                if (next <= 0) {
                    obs.push(new Cactus());
                    next = Math.random() * 20 + 30;
                }

                obs = obs.filter(o => {
                    o.x -= speed;
                    o.draw();
                    if (!god && o.hits(dino)) {
                        over = true;
                        if (score > high) high = score;
                        if (audioEnabled) gameOverAudio.play();
                    }
                    return o.x > -50;
                });

                ctx.fillStyle = '#000';
                ctx.font = 'bold 18px Courier';
                ctx.textAlign = 'right';
                ctx.fillText('HI ' + String(Math.floor(high)).padStart(5, '0'), 790, 30);
                ctx.fillText(String(Math.floor(score)).padStart(5, '0'), 790, 55);

                // Audio triggers
                if (score >= 1000 && score % 1000 === 0 && audioEnabled) {
                    applause.play();
                } else if (score >= 10000 && score % 10000 === 0 && audioEnabled) {
                    celebration.play();
                } else if (score % 100 === 0 && audioEnabled) {
                    audioDing.play();
                }

                frame++;
                requestAnimationFrame(loop);
            }

            document.addEventListener('keydown', e => {
                if (e.code === 'Space') {
                    if (!start) { start = true; return; }
                    if (over) return;
                    const now = Date.now();
                    if (now - last < 1000) space++;
                    else space = 1;
                    last = now;
                    if (space >= 2 && !fly) {
                        fly = true;
                        space = 0;
                    } else if (!fly && !dino.jump && dino.y >= 150) {
                        dino.dy = -11;
                        dino.jump = true;
                    }
                }
                if (e.code === 'ArrowUp' && fly) { e.preventDefault(); keys.u = true; }
                if (e.code === 'ArrowDown' && fly) { e.preventDefault(); keys.d = true; }
                if (e.code === 'KeyR') {
                    if (over) {
                        score = 0; speed = 6; over = false; start = false;
                        obs = []; frame = 0; next = 100;
                        dino.y = 150; dino.dy = 0; dino.jump = false;
                        fly = false; god = false; space = 0;
                        keys = {u:false, d:false};
                        loop();
                    } else if (start) {
                        fly = !fly;
                    }
                }
            });

            document.addEventListener('keyup', e => {
                if (e.code === 'ArrowUp') keys.u = false;
                if (e.code === 'ArrowDown') keys.d = false;
            });

            loop();
        }

        promptAudio();
    </script>
</body>
</html>
