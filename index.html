<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dino Warp: Tactical Mach</title>
    <style>
        body { margin: 0; background: #050510; overflow: hidden; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #container { position: relative; width: 800px; height: 350px; background: #87CEEB; border-bottom: 6px solid #4a3728; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; image-rendering: pixelated; }
        #gui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.7); z-index: 20; cursor: pointer; color: white; }
        .pixel-btn { background: #548d44; padding: 15px 30px; border: 4px solid #fff; font-weight: bold; font-size: 24px; box-shadow: 6px 6px #000; }
    </style>
</head>
<body>
    <div id="container">
        <div id="gui" onclick="startOrRestart()">
            <div class="pixel-btn">COMMENCE WARP</div>
            <p style="margin-top: 15px;">Use Space to Jump | Use Arrows to Pilot</p>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 350;

        const GROUND_Y = 310;
        const GITHUB_BASE = "https://raw.githubusercontent.com/yyy293/dino-game/main/";

        const snd = {
            m1k: new Audio(GITHUB_BASE + "aplausos_2.mp3"),
            lose: new Audio(GITHUB_BASE + "directed-by-robert-b_voI2Z4T.mp3")
        };

        let state = {
            started: false, over: false, score: 0, speed: 7,
            frame: 0, isNight: false, jumpCount: 0, 
            isFlying: false, keys: {}, particles: [], boom: 0
        };

        const dino = { x: 50, y: GROUND_Y - 44, dy: 0 };
        let obstacles = [], stars = [], clouds = [];

        for(let i=0; i<40; i++) stars.push({x: Math.random()*800, y: Math.random()*250, s: 0.8 + Math.random()});
        for(let i=0; i<5; i++) clouds.push({x: Math.random()*800, y: 30 + Math.random()*80, w: 40 + Math.random()*40});

        function startOrRestart() {
            for (let s in snd) { snd[s].load(); snd[s].play().then(()=> {snd[s].pause(); snd[s].currentTime=0;}).catch(()=>{}); }
            state.started = true; state.over = false; state.score = 0; state.speed = 8;
            state.jumpCount = 0; state.isFlying = false; state.particles = []; state.boom = 0;
            obstacles = []; dino.y = GROUND_Y - 44; dino.dy = 0;
            document.getElementById('gui').style.display = 'none';
        }

        function drawDino(x, y) {
            ctx.fillStyle = "#548d44";
            ctx.fillRect(x + 18, y, 22, 18); // Head
            ctx.fillStyle = "#d0f0c0"; ctx.fillRect(x + 10, y + 15, 25, 22); // Belly
            ctx.fillStyle = "#548d44"; ctx.fillRect(x + 10, y + 15, 15, 22); // Back
            ctx.fillRect(x, y + 18, 10, 12); // Tail
            ctx.fillStyle = "#fff"; ctx.fillRect(x + 32, y + 4, 4, 4); // Eye
            let legShift = state.isFlying ? Math.sin(state.frame * 0.6) * 6 : (Math.floor(state.frame / 4) % 2 * 6);
            ctx.fillStyle = "#3a6330"; 
            ctx.fillRect(x + 12, y + 36 + legShift, 7, 8);
            ctx.fillRect(x + 26, y + 36 - legShift, 7, 8);
        }

        function drawCactus(x, y, w) {
            ctx.fillStyle = "#2d5a27"; // Darker base
            ctx.fillRect(x + 10, y, 10, 40); // Main trunk
            ctx.fillStyle = "#76a969"; // Highlight green
            ctx.fillRect(x + 12, y, 4, 40);
            // Arms with realistic pixel offsets
            ctx.fillStyle = "#2d5a27";
            ctx.fillRect(x, y + 15, 10, 5); ctx.fillRect(x, y + 5, 5, 12); // Left arm
            ctx.fillRect(x + 20, y + 10, 10, 5); ctx.fillRect(x + 25, y + 0, 5, 12); // Right arm
        }

        function update() {
            if (!state.started || state.over) return;
            state.frame++; state.score += state.speed / 30;
            state.isNight = Math.floor(state.score / 800) % 2 === 1;

            if (state.isFlying) {
                if (state.keys['ArrowUp']) dino.dy = -12;
                if (state.keys['ArrowDown']) dino.dy = 12;
                dino.y += (dino.dy - dino.y * 0.01) * 0.12; 
                dino.dy *= 0.85; 
            } else {
                dino.dy += 0.8;
                dino.y += dino.dy;
            }

            if (dino.y > GROUND_Y - 44) { dino.y = GROUND_Y - 44; dino.dy = 0; state.isFlying = false; state.jumpCount = 0; }
            if (dino.y < 10) dino.y = 10;

            // DUST
            if (dino.y >= GROUND_Y - 45) state.particles.push({x: dino.x + 5, y: GROUND_Y - 5, life: 15});
            state.particles.forEach(p => { p.x -= state.speed; p.life--; });
            state.particles = state.particles.filter(p => p.life > 0);

            if (state.speed > 16 && state.frame % 300 === 0) state.boom = 1;
            if (state.boom > 0) state.boom += 0.25;
            if (state.boom > 15) state.boom = 0;

            state.speed += 0.004;
            stars.forEach(s => { s.x -= state.speed * s.s; if(s.x < -100) s.x = 850; });
            clouds.forEach(c => { c.x -= state.speed * 0.3; if(c.x < -150) c.x = 850; });

            // OBSTACLE ENGINE (Rifle Variety)
            if (state.frame % Math.max(15, Math.floor(400/state.speed)) === 0) {
                let r = Math.random();
                if (r > 0.6) { // Different Bird "Rifles"
                    let variant = Math.random();
                    let bird = {x: 850, w: 35, h: 25, type: 'bird'};
                    if (variant > 0.8) { bird.speedMult = 1.8; bird.y = GROUND_Y - 100; bird.color = "#FFD700"; } // Sniper
                    else if (variant > 0.4) { bird.speedMult = 1.0; bird.y = GROUND_Y - 150; bird.color = "#c04040"; } // Standard
                    else { bird.speedMult = 0.7; bird.w = 50; bird.h = 40; bird.y = GROUND_Y - 60; bird.color = "#4a3b37"; } // Heavy
                    obstacles.push(bird);
                } else {
                    obstacles.push({x: 850, y: GROUND_Y - 40, w: 30, h: 40, type: 'cactus'});
                }
            }

            obstacles.forEach(o => {
                o.x -= state.speed * (o.speedMult || 1);
                if (dino.x < o.x + o.w && dino.x + 35 > o.x && dino.y < o.y + o.h && dino.y + 40 > o.y) {
                    state.over = true; snd.lose.play().catch(()=>{});
                    document.getElementById('gui').style.display = 'flex';
                }
            });
            obstacles = obstacles.filter(o => o.x > -100);
        }

        function draw() {
            ctx.fillStyle = state.isNight ? "#050510" : "#87CEEB";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Celestial
            ctx.fillStyle = state.isNight ? "#fff" : "#FFD700";
            ctx.beginPath(); ctx.arc(700, 60, state.isNight ? 25 : 35, 0, Math.PI*2); ctx.fill();

            // Stars/Warp
            ctx.fillStyle = "#fff";
            let beam = Math.max(0, (state.speed - 12) * 15);
            stars.forEach(s => { ctx.fillRect(s.x, s.y, 2 + beam, 2); });

            // Clouds
            ctx.fillStyle = "rgba(255,255,255,0.7)";
            clouds.forEach(c => { ctx.fillRect(c.x, c.y, c.w, 15); ctx.fillRect(c.x+10, c.y-10, c.w-20, 10); });

            // Sonic Boom
            if (state.boom > 0) {
                ctx.strokeStyle = `rgba(255,255,255,${1 - state.boom/15})`;
                ctx.lineWidth = 5;
                ctx.beginPath(); ctx.arc(dino.x+20, dino.y+20, state.boom * 40, 0, Math.PI*2); ctx.stroke();
            }

            // Ground & Dust
            ctx.fillStyle = state.isNight ? "#12122b" : "#e3c9a1"; // Sand color for day
            ctx.fillRect(0, GROUND_Y, 800, 40);
            ctx.fillStyle = state.isNight ? "#444" : "#b5a382";
            state.particles.forEach(p => { ctx.fillRect(p.x, p.y, 4, 4); });

            drawDino(dino.x, dino.y);
            
            obstacles.forEach(o => {
                if(o.type === 'cactus') drawCactus(o.x, o.y, o.w);
                else {
                    ctx.fillStyle = o.color;
                    ctx.fillRect(o.x, o.y, o.w, o.h);
                    ctx.fillStyle = "#000"; ctx.fillRect(o.x + o.w - 10, o.y + 5, 4, 4); // Eye
                }
            });

            if (state.isFlying) {
                ctx.fillStyle = "#ff8c00"; ctx.font = "bold 24px Courier New";
                ctx.textAlign = "center"; ctx.fillText("FLIGHT ENABLED!", 400, 50); ctx.textAlign = "start";
            }

            ctx.fillStyle = "#e63946"; ctx.font = "bold 14px Courier New";
            ctx.fillText("SPEED: MACH " + (state.speed / 16).toFixed(2), 20, 340);
            ctx.fillStyle = state.isNight ? "#fff" : "#535353";
            ctx.fillText("SCORE: " + Math.floor(state.score), 700, 40);
        }

        function loop() { update(); draw(); requestAnimationFrame(loop); }

        window.addEventListener('keydown', e => {
            state.keys[e.code] = true;
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                if (!state.isFlying) {
                    state.jumpCount++;
                    if (state.jumpCount >= 3) { state.isFlying = true; dino.dy = 0; }
                    else { dino.dy = -14; }
                }
            }
            if (e.code === 'KeyR') { state.isFlying = false; state.jumpCount = 0; }
        });
        window.addEventListener('keyup', e => { state.keys[e.code] = false; });

        loop();
    </script>
</body>
</html>
