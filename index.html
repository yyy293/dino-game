<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dino Game - Mach 100 Zoom</title>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f7f7f7; font-family: 'Courier New', Courier, monospace; overflow: hidden; touch-action: none; }
        #container { position: relative; width: 800px; height: 200px; overflow: hidden; border-bottom: 2px solid #535353; background-color: #fff; }
        canvas { display: block; }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="gameCanvas"></canvas>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('container');
        canvas.width = 800; canvas.height = 200;

        const GRAVITY = 1.2;
        const JUMP_FORCE = -20;
        const GROUND_Y = 150;
        const SKY_Y = 20;
        const BASE_SPEED = 100;

        let dinoLoaded = false, cactusLoaded = false, canFly = false;
        let tapCount = 0, lastTapTime = 0;
        let spaceCount = 0, lastSpaceTime = 0;
        let gameSpeed = BASE_SPEED;
        let score = 0, highScore = localStorage.getItem('dinoHighScore') || 0;
        let isGameOver = false, obstacles = [], animationFrameId;
        let currentZoom = 1;

        const dinoImg = new Image();
        dinoImg.src = 'Screenshot_2025-12-27-14-38-59-263_com.android.chrome-edit.jpg';
        dinoImg.onload = () => dinoLoaded = true;

        const cactusImg = new Image();
        cactusImg.src = 'Screenshot_2025-12-27-14-52-08-378_com.android.chrome-edit.jpg';
        cactusImg.onload = () => cactusLoaded = true;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            if (type === 'jump') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.type = 'triangle'; osc.frequency.setValueAtTime(150, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(); osc.stop(now + 0.1);
            } else if (type === 'death') {
                const notes = [{f:196,s:0,d:0.4},{f:196,s:0.45,d:0.4},{f:155.56,s:0.9,d:1.5}];
                notes.forEach(n => {
                    const masterGain = audioCtx.createGain();
                    masterGain.connect(audioCtx.destination);
                    ['triangle','sawtooth','sine','square'].forEach((t,i) => {
                        const osc = audioCtx.createOscillator();
                        const g = audioCtx.createGain();
                        osc.type = t;
                        let freq = i === 2 ? n.f/2 : (i === 3 ? n.f/4 : n.f);
                        osc.frequency.setValueAtTime(freq, now + n.s);
                        g.gain.setValueAtTime(0, now + n.s);
                        g.gain.linearRampToValueAtTime(i === 3 ? 0.05 : 0.1, now + n.s + 0.05);
                        g.gain.exponentialRampToValueAtTime(0.001, now + n.s + n.d);
                        osc.connect(g); g.connect(masterGain);
                        osc.start(now + n.s); osc.stop(now + n.s + n.d);
                    });
                });
            }
        }

        const dino = {
            x: 50, y: GROUND_Y, width: 44, height: 47, dy: 0,
            draw() {
                if (dinoLoaded) ctx.drawImage(dinoImg, this.x, this.y, this.width, this.height);
                else { ctx.fillStyle = canFly ? "#3498db" : "#53a653"; ctx.fillRect(this.x, this.y, this.width, this.height); }
            },
            update() {
                if (!canFly) {
                    this.dy += GRAVITY; this.y += this.dy;
                    if (this.y >= GROUND_Y) { this.y = GROUND_Y; this.dy = 0; }
                } else { this.y = SKY_Y; this.dy = 0; }
                this.draw();
            },
            jump() { if (!canFly && this.y >= GROUND_Y - 10 && !isGameOver) { this.dy = JUMP_FORCE; playSound('jump'); } }
        };

        class Obstacle {
            constructor() {
                this.x = canvas.width; this.width = 30; this.height = 45;
                this.y = GROUND_Y + (47 - this.height);
            }
            update() {
                this.x -= gameSpeed;
                if (cactusLoaded) ctx.drawImage(cactusImg, this.x, this.y, this.width, this.height);
                else { ctx.fillStyle = "#ff4d4d"; ctx.fillRect(this.x, this.y, this.width, this.height); }
            }
        }

        function resetGame() {
            score = 0; gameSpeed = BASE_SPEED; isGameOver = false; obstacles = [];
            dino.y = GROUND_Y; dino.dy = 0; canFly = false; tapCount = 0; spaceCount = 0;
            currentZoom = 1; canvas.style.transform = `scale(1)`;
            cancelAnimationFrame(animationFrameId); animate();
        }

        function animate() {
            if (isGameOver) {
                ctx.fillStyle = "rgba(0,0,0,0.1)"; ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle = "black"; ctx.font = "bold 24px Courier";
                ctx.fillText("GAME OVER", canvas.width/2 - 60, canvas.height/2);
                return;
            }

            let inDanger = false;
            obstacles.forEach(obs => {
                let dist = obs.x - (dino.x + dino.width);
                if (dist > 0 && dist < 180 && !canFly) inDanger = true;
            });

            if (inDanger) {
                gameSpeed = gameSpeed * 0.85 + 10 * 0.15;
                currentZoom = currentZoom * 0.9 + 1.2 * 0.1;
            } else {
                gameSpeed = gameSpeed * 0.95 + BASE_SPEED * 0.05;
                currentZoom = currentZoom * 0.9 + 1.0 * 0.1;
            }

            canvas.style.transform = `scale(${currentZoom})`;
            canvas.style.transformOrigin = `${dino.x + 100}px ${dino.y}px`;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            score += 1;
            dino.update();
            
            if (Math.random() < 0.1) {
                if (obstacles.length === 0 || obstacles[obstacles.length-1].x < canvas.width - 600) {
                    obstacles.push(new Obstacle());
                }
            }

            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].update();
                if (dino.x < obstacles[i].x + obstacles[i].width - 15 &&
                    dino.x + dino.width - 15 > obstacles[i].x &&
                    dino.y < obstacles[i].y + obstacles[i].height - 15 &&
                    dino.y + dino.height - 15 > obstacles[i].y) {
                    isGameOver = true; playSound('death');
                    if (score > highScore) { highScore = score; localStorage.setItem('dinoHighScore', highScore); }
                }
                if (obstacles[i].x + obstacles[i].width < -100) obstacles.splice(i, 1);
            }

            ctx.fillStyle = "#535353"; ctx.font = "16px Courier";
            ctx.fillText(`HI ${highScore.toString().padStart(5, '0')} ${score.toString().padStart(5, '0')}`, 650, 30);
            animationFrameId = requestAnimationFrame(animate);
        }

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                const now = Date.now();
                if (now - lastSpaceTime < 400) spaceCount++; else spaceCount = 1;
                lastSpaceTime = now;
                if (spaceCount === 3) canFly = true;
                dino.jump();
            }
            else if (e.code === 'ArrowUp') dino.jump();
            else if (e.code === 'KeyR') resetGame();
        });

        const handleMouse = (e) => {
            const now = Date.now();
            if (now - lastTapTime < 400) tapCount++; else tapCount = 1;
            lastTapTime = now;
            if (tapCount === 2) canFly = true;
            dino.jump();
        };

        window.addEventListener('mousedown', handleMouse);
        window.addEventListener('touchstart', (e) => { e.preventDefault(); handleMouse(e); }, { passive: false });
        animate();
    </script>
</body>
</html>
