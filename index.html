<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dino Warp: Auto Edition</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #container { position: relative; width: 800px; height: 350px; background: #f7f7f7; border-bottom: 4px solid #535353; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 350;

        // --- AUDIO CONFIG ---
        const snd = {
            m1k: new Audio('main/aplausos_2.mp3'),
            m10k: new Audio('main/-audiotrimmer_adesehy.mp3'),
            lose: new Audio('main/directed-by-robert-b_voI2Z4T.mp3')
        };

        // Pre-load logic to help with "automatic" playback
        for (let key in snd) {
            snd[key].preload = 'auto';
            snd[key].load();
        }

        let state = {
            started: false, over: false, score: 0, speed: 6,
            highScore: localStorage.getItem('dinoHS') || 0,
            frame: 0, m1kPlayed: false, m10kPlayed: false,
            isDucking: false
        };

        const dino = { x: 50, y: 280, dy: 0, ground: 280, w: 40, h: 40 };
        let obstacles = [], birds = [], stars = [];

        // Setup stars for night mode
        for(let i=0; i<40; i++) stars.push({x: Math.random()*800, y: Math.random()*200, r: Math.random()*1.5});

        function gameLoop() {
            if (state.over) return;
            if (state.started) update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            state.frame++;
            state.score += 0.08; // Slower point collection as requested

            // Milestone Audio
            if (state.score >= 1000 && !state.m1kPlayed) { snd.m1k.play(); state.m1kPlayed = true; }
            if (state.score >= 10000 && !state.m10kPlayed) { snd.m10k.play(); state.m10kPlayed = true; }

            // Physics
            dino.dy += 0.8; 
            dino.y += dino.dy;
            if (dino.y >= dino.ground) { dino.y = dino.ground; dino.dy = 0; }
            
            state.speed += 0.001;

            // Spawn Obstacles (Cacti) - No floating
            if (state.frame % Math.max(45, Math.floor(700/state.speed)) === 0) {
                obstacles.push({x: 850, y: 280, w: 25, h: 40});
            }

            // Spawn Pterodactyls (Every 500 points)
            if (state.score >= 500 && state.frame % 160 === 0) {
                let birdHeight = Math.random() > 0.5 ? 230 : 275; // 230 requires ducking, 275 requires jumping
                birds.push({x: 850, y: birdHeight, w: 40, h: 25});
            }

            // Collision
            const checkHit = (o) => {
                let hitH = state.isDucking ? 20 : 40;
                let hitY = state.isDucking ? dino.y + 20 : dino.y;
                return dino.x < o.x + o.w &&
                       dino.x + 30 > o.x &&
                       hitY < o.y + o.h &&
                       hitY + hitH > o.y;
            };

            obstacles.forEach((o, i) => {
                o.x -= state.speed;
                if (checkHit(o)) endGame();
                if (o.x < -50) obstacles.splice(i, 1);
            });

            birds.forEach((b, i) => {
                b.x -= (state.speed + 2);
                if (checkHit(b)) endGame();
                if (b.x < -50) birds.splice(i, 1);
            });
        }

        function endGame() {
            state.over = true;
            snd.lose.play();
            if (state.score > state.highScore) {
                state.highScore = Math.floor(state.score);
                localStorage.setItem('dinoHS', state.highScore);
            }
        }

        function draw() {
            // Day/Night flip every 500 points
            let isNight = Math.floor(state.score / 500) % 2 === 1;
            ctx.fillStyle = isNight ? "#222" : "#f7f7f7";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            let color = isNight ? "#fff" : "#535353";

            // Orbiting Sun/Moon
            let orbit = (state.score % 500) / 500;
            ctx.fillStyle = isNight ? "#f0f0f0" : "#ffcc00";
            ctx.beginPath();
            ctx.arc(800 - (orbit * 850), 60 + Math.sin(orbit * Math.PI) * 30, 25, 0, Math.PI*2);
            ctx.fill();

            if (isNight) {
                ctx.fillStyle = "#666";
                stars.forEach(s => ctx.fillRect(s.x, s.y, s.r, s.r));
            }

            // Dino
            ctx.fillStyle = color;
            if (state.isDucking) {
                ctx.fillRect(dino.x, dino.y + 20, 45, 20); // Ducking shape
            } else {
                ctx.fillRect(dino.x + 15, dino.y, 20, 15); // Head
                ctx.fillRect(dino.x + 10, dino.y + 10, 25, 25); // Body
                ctx.fillRect(dino.x + 12, dino.y + 35, 6, 8); // Legs
                ctx.fillRect(dino.x + 25, dino.y + 35, 6, 8);
            }

            // Obstacles
            ctx.fillStyle = isNight ? "#77ff77" : "#535353";
            obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.w, o.h));

            // Birds (Animated wings)
            birds.forEach(b => {
                ctx.fillStyle = isNight ? "#ff7777" : "#535353";
                ctx.fillRect(b.x, b.y, b.w, 10);
                let flap = (state.frame % 20 < 10) ? -12 : 12;
                ctx.fillRect(b.x + 10, b.y + (flap < 0 ? flap : 0), 5, Math.abs(flap));
            });

            // HUD
            ctx.fillStyle = color;
            ctx.font = "16px Courier New";
            ctx.textAlign = "right";
            ctx.fillText(`HI ${state.highScore.toString().padStart(5, '0')}  ${Math.floor(state.score).toString().padStart(5, '0')}`, 780, 40);

            if (!state.started) {
                ctx.textAlign = "center";
                ctx.fillText("PRESS SPACE TO START", 400, 175);
            }
            if (state.over) {
                ctx.fillStyle = "rgba(0,0,0,0.8)";
                ctx.fillRect(0, 0, 800, 350);
                ctx.fillStyle = "#fff"; ctx.textAlign = "center";
                ctx.fillText("GAME OVER - PRESS R", 400, 175);
            }
        }

        window.addEventListener('keydown', e => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                if (!state.started) state.started = true;
                if (dino.y >= dino.ground) dino.dy = -13;
            }
            if (e.code === 'ArrowDown') state.isDucking = true;
            if (e.code === 'KeyR' && state.over) location.reload();
        });

        window.addEventListener('keyup', e => {
            if (e.code === 'ArrowDown') state.isDucking = false;
        });

        gameLoop();
    </script>
</body>
</html>
